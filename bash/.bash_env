#! /bin/bash
#
# Path additions
#

if [ -d "$HOME/.bin" ]; then
    export PATH=$PATH:$HOME/.bin
fi

#
# Environment variables
#

export EDITOR=vim
export SUDO_EDITOR=vim
export RANGER_LOAD_DEFAULT_RC=FALSE

#
# Aliases
#

alias ls='ls --color=auto'
alias ll='ls -lh'
alias la='ll -A'

alias cls='clear; ls'

alias tmux='tmux -2'

alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

alias bsrc='source ~/.bash_profile'
alias Xres='xrdb -merge ~/.Xresources'

alias pg='ps -ef | grep -v grep | grep'
alias ff='find . -type f -iname'

alias vim-prof='vim --startuptime /dev/stdout +qall'
alias vim-maps="vim -c 'redir > ~/vim-maps.txt' -c 'map' -c 'qa!'"

alias games='pacman -Qlq bsd-games | grep -P "bin/.+" | xargs -n1 basename'

# pacman
alias pac-junk='pacman -Qdtq'
alias pac-aur='pacman -Qmq'
alias pac-manual='comm -23 <(pacman -Qeq|sort) <(pacman -Qgq base base-devel|sort)'
alias pac-standalone='comm -23 <(pacman -Qetq|sort) <(pacman -Qgq base base-devel|sort)'
alias pac-log='vim /var/log/pacman.log'
alias pac-big="pacgraph -c | grep --color=never -P 'GB|[0-9]{2,}MB|[0-9]{5,}kB'"

# bspwm
alias mon-geo="bspc wm -d | jq -r -c '.focusedMonitorId as \$monid | .monitors[] | select(.id == \$monid) .rectangle | [.width, .height] | \"\\(.[0])x\\(.[1])\"'"

# IP addresses
alias myip='echo "$(curl -s ipecho.net/plain)"'

# URL-encode strings
alias urlencode='python2 -c "import sys, urllib as ul; print ul.quote_plus(sys.argv[1]);"'

# ROT13-encode text. Works for decoding, too! ;)
alias rot13='tr a-zA-Z n-za-mN-ZA-M'

#
# Functions
#
cl() {
    clear; cd "$@" && ls
}

# move back directories
bk() {
    back="cd .."
    if [ -n "$1" ] && [ "$1" -gt 1 ]; then
        for i in $(seq 2 $1); do
            back="${back}/.."
        done
    fi
    eval "$back"
}

conf() {
    case "$1" in
        vim)                  $EDITOR ~/.vimrc ;;
        plug*)                $EDITOR ~/.vimrc.plugins ;;
        bash)                 $EDITOR ~/.bashrc ;;
        conf|alias|func|env*) $EDITOR ~/.bash_env ;;
        X*)                   $EDITOR ~/.Xresources ;;
        tmux)                 $EDITOR ~/.tmux.conf ;;
        zsh*)                 $EDITOR ~/.zshrc ;;
        prez*)                $EDITOR ~/.zpreztorc ;;
        prompt)               $EDITOR ~/.zfunctions/prompt_subliminal_setup ;;
        sxh*)                 $EDITOR ~/.config/sxhkd/sxhkdrc ;;
        bspwm)                $EDITOR ~/.config/bspwm/bspwmrc ;;
        *)
            awk '/conf\(\)/{p=1;print;next} p&&/ \*\)/{p=0};p' ~/.bash_env | \
                tail -n +3 | sed -e 's/^ *//g'
            [ -n "$1" ] && echo "Unrecognized config command: '$1'" >&2
            ;;
    esac
}

shparproc() {
    head -1 "/proc/$PPID/status" | cut -f2
}

# change extensions for all files in the current directory
chext() {
    if [[ "$*" == *-h* ]]; then
        echo "chext '.old_ext' '.new_ext'"
        echo 'Changes file extensions in the current directory'
        echo 'NOTE: include the period in both extensions, as above'
        return 0
    fi
    if [ -n "$1" ] && [ -n "$2" ]; then
        for f in *$1; do
            name=$(echo "$f" | cut -d . -f 1)
            new=$name$2
            mv -iv "$f" "$new"
        done
    else
        echo "chext '.old_ext' '.new_ext'"
        echo 'Changes file extensions in the current directory'
        echo 'NOTE: include the period in both extensions, as above'
        return 1
    fi
}

cmd-exists() {
    type "$1" &> /dev/null
}

gui2pid() {
    xprop _NET_WM_PID | sed 's/_NET_WM_PID(CARDINAL) = //' | ps "$(cat)"
}

ping-avg() {
    if [ -n "$2" ]; then
        count="$2"
    else
        count=20
    fi
    ping "$1" -c "$count" -A -q | tail -1 | cut -d'/' -f5
}
